---
Exercise:
  title: 练习：预配 Azure 容器注册表 (ACR) 和 Azure Kubernetes 服务 (AKS)
  module: Guided Project - Deploy applications to Azure Kubernetes Service
---

# 练习 - 将应用程序部署到 Azure Kubernetes 服务 (AKS)

## 目标

此引导项目包括以下练习：

+ **练习 1：预配 Azure 容器注册表 (ACR) 和 Azure Kubernetes 服务 (AKS)。**
+ 练习 2：生成 Linux 和 Windows 容器映像并将其存储在 Azure 容器注册表。
+ 练习 3：将容器映像部署到 Azure Kubernetes 服务。
+ 练习 4：查看部署并取消预配所有资源。

在本练习中，你将预配 Azure 容器注册表和 Azure Kubernetes 服务资源。
## 练习 1：预配 Azure 容器注册表 (ACR) 和 Azure Kubernetes 服务 (AKS)
在本练习中，你将创建 Azure 容器注册表和 AKS 群集。

>注意：为了完成本练习，你将需要一个 [Azure 订阅](https://azure.microsoft.com/free/)****。
> 对于未指定的任何属性，请使用默认值。

### 任务 1：创建 Azure 容器注册表
在此任务中，你将创建 Azure 容器注册表

1. 在计算机中，打开 Web 浏览器窗口并导航到 Azure 门户 (https://portal.azure.com)。
1. 在系统提示时，请通过使用在你将用于此实验室的 Azure 订阅中具有所有者角色的用户帐户进行登录。 
1. 登录 Azure 门户。 
1. 在 Azure 门户的“**搜索**”文本框中，搜索并选择“**容器注册表**”。
1. 在“**容器注册表**”页上，选择“**+ 创建**”并指定以下设置：

   |设置|值|
   |---|---|
   |订阅|你将在此实验室中使用的 Azure 订阅的名称|
   |资源组|新资源组的名称 **acr-01-RG**|
   |注册表名称|由 5 到 50 个字母数字字符组成的任何有效、全局唯一的名称|
   |区域|可在其中创建 Azure 容器注册表和 AKS 群集的任何 Azure 区域|
   |可用性区域|**无**|
   |SKU|**基本**|

1. 在“**容器注册表**”页上，选择“**查看 + 创建**”，然后在“**查看 + 创建**”选项卡上，选择“**创建**”。

   > **注意：** 继续进行下一个练习，而无需等待 Azure 容器注册表预配完成。

### 任务 2：创建 Azure 虚拟网络和 AKS 群集
在此任务中，你将创建一个 Azure 虚拟网络，并在其中部署一个 Windows 节点池的 AKS 群集。

> **注意：** 虽然可以在预配 AKS 群集时创建虚拟网络，但将 AKS 群集部署到现有虚拟网络需要额外做一些考虑，并且你需要熟悉所考虑的事项。

1. 在 Azure 门户的“**搜索**”文本框中，搜索并选择“**虚拟网络**”。
1. 在“**虚拟网络**”页上，选择“**+ 创建**”，然后在“**创建虚拟网络**”页的“**基本信息**”选项卡上，指定以下设置：

   |设置|值|
   |---|---|
   |订阅|在此实验室的第一个练习中选择的 Azure 订阅名称|
   |资源组|新资源组的名称 **aks-01-RG**|
   |虚拟网络名称|**vnet-01**|
   |区域|在此实验室的第一个练习中选择的同一 Azure 区域|

1. 在“**创建虚拟网络**”页的“**基本信息**”选项卡上，选择“**下一步**”。
1. 在“**创建虚拟网络**”页的“**安全性**”选项卡上，接受默认设置并选择“**下一步**”。
1. 在“**创建虚拟网络**”页的“**IP 地址**”选项卡上，确保 IP 地址空间设置为 **10.0.0.0/16**，删除 **默认** 子网，选择“**查看 + 创建**”，然后在“**查看 + 创建**”选项卡上选择“**创建**”。

   > **注意：** 创建虚拟网络应该只需几秒钟，因此你应该能够直接转到下一步。

1. 在 Azure 门户的“**搜索**”文本框中，搜索并选择“**Kubernetes 服务**”。
1. 在“Kubernetes 服务”页上，选择“+ 创建”，在下拉列表中选择“创建 Kubernetes 群集”，然后在“创建 Kubernetes 群集”页的“基本信息”选项卡上指定以下设置并选择“下一步”：************************

   |设置|值|
   |---|---|
   |订阅|在此实验室的第一个练习中选择的 Azure 订阅名称|
   |资源组|**aks-01-RG**|
   |群集预设配置|开发/测试|
   |Kubernetes 群集名称|**aks-01**|
   |区域|在此实验室的第一个练习中选择的同一 Azure 区域|
   |可用性区域|**无**|
   |AKS 定价层|**免费**|
   |Kubernetes 版本|接受默认值|
   |自动升级|已禁用|
   |节点安全通道类型|**无**|
   |身份验证和授权|**使用 Kubernetes RBAC 本地帐户**|

1. 在“创建 Kubernetes 群集”页的“节点池”选项卡上，执行以下任务：********

   - 在“节点池”部分中，选择“代理池”链接。********
   - 在“更新节点池”页上的“节点大小”部分中，选择“选择大小”链接。************
   - 在“选择 VM 大小”页上的 VM 大小列表中，选择“B4ms”，然后单击“选择”。************
   - 返回“更新节点池”页，将“缩放方法”设置为“手动”，将“节点计数”设置为“2”。********************
   - 在“更新节点池”页上，选择“更新”。********

   > **注意：** 可能需要增加 vCPU 配额或更改 VM SKU 以适应节点大小和节点计数值。 有关增加 vCPU 配额过程的信息，请参阅 Microsoft Learn 文章：[增加 VM 系列 vCPU 配额](https://learn.microsoft.com/en-us/azure/quotas/per-vm-quota-requests)。

   > **注意：** 你会将 Windows 节点池添加到群集。 这需要将网络配置从默认的 **Kubenet** 更改为 **Azure CNI**。 Kubenet 网络配置不支持 Windows 节点池。

1. 返回“创建 Kubernetes 群集”页的“节点池”选项卡，选择“下一步”。************
1. 在“创建 Kubernetes 群集”页的“网络”选项卡上，选择“Azure CNI”选项，然后选中“自带虚拟网络”复选框，在“虚拟网络”下拉列表中选择“vnet-01”，最后在“群集子网”文本框下选择“管理子网配置”。********************************
1. 在“**vnet-01 \| 子网**”页中，选择“**+ 子网**”。
1. 在“**添加子网**”页中，指定以下设置，然后选择“**保存**”：

   |设置|值|
   |---|---|
   |名称|**aks-subnet**|
   |子网地址范围|**10.0.0.0/20**|

1. 返回“**vnet-01 \| 子网**”页，在页面左上角的痕迹导航路径中，选择“**创建 Kubernetes 群集**”。 
1. 返回到“**创建 Kubernetes 群集**”页的“**网络**”选项卡，指定以下设置：

   |设置|值|
   |---|---|
   |虚拟网络|**vnet-01**|
   |群集子网|**aks-subnet (10.0.0.0/20)**|
   |Kubernetes 服务地址范围|**172.16.0.0/22**|
   |Kubernetes DNS 服务 IP 地址|**172.16.3.254**|
   |DNS 名称前缀|**aks-01-dns**|
   |网络策略|**无**|

1. 在“创建 Kubernetes 群集”页的“网络”选项卡上，选择“上一步”。************
1. 返回“创建 Kubernetes 群集”页的“节点池”选项卡，选择“+ 添加节点池”。************
1. 在“**添加节点池**”页上，指定以下设置：

   |设置|“值”|
   |---|---|
   |节点池名称|**w1pool**|
   |模型|**用户**|
   |OS 类型|Windows 2022****|
   |可用性区域|**无**|
   |启用 Azure 现成实例|已禁用|
   |节点大小|**B4ms**|
   |缩放方法|**手动**|
   |节点计数|**2**|
   |每个节点的最大 Pod 数|**30**|
   |启用每个节点的公共 IP|已禁用|

   > **注意：** 这里可能也需要增加 vCPU 配额或更改 VM SKU 以适应节点大小和节点计数值。

1. 在“**添加节点池**”页上，选择“**添加**”。
1. 返回“创建 Kubernetes 群集”页的“节点池”选项卡，选择“下一步”。************
1. 在“创建 Kubernetes 群集”页的“网络”选项卡上，选择“下一步”。************
1. 在“创建 Kubernetes 群集”页“集成”选项卡上的“容器注册表”下拉列表中，选择代表你在上一练习中创建的表示 Azure 容器注册表的条目，禁用“启用建议的警报规则”复选框，确保已禁用“Azure Policy”选项后选择“下一步”。************************
1. 在“创建 Kubernetes 群集”页的“监视 ”选项卡上，取消选中“启用 Prometheus 指标”复选框，然后选择“查看 + 创建”。****************
1. 在“**创建 Kubernetes 群集**”页的“**查看 + 创建**”选项卡上，选择“**创建**”。

   > **注意：** 继续进行下一个练习，而无需等待 AKS 群集的预配完成。 预配过程可能需要 5 分钟。
